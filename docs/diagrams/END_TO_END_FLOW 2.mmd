%% Status: FROZEN
%% Last aligned with code: 2026-02-08
sequenceDiagram
  autonumber
  participant C as Customer
  participant W as WhatsApp
  participant UI as FrostDesk UI
  participant AI as AI Assistant
  participant BK as Booking System

  C->>W: Request lesson
  W->>UI: Conversation ingested

  UI->>AI: Generate draft reply + booking proposal
  AI-->>UI: Draft text + proposed slots (no DB write)

  alt Instructor sends from FrostDesk
    UI->>W: Send message (human)
    UI->>UI: Set ai_state = ai_paused_by_human
  else Instructor replies externally
    UI->>UI: Show "Possible external reply" badge
  end

  opt Instructor creates booking draft
    UI->>BK: POST /bookings (status=draft)
    BK-->>UI: booking_id
  end

  C->>W: Confirms details
  W->>UI: Message ingested

  UI->>AI: Draft next suggestion
  AI-->>UI: Suggest submit or alternatives

  alt Instructor submits request
    UI->>BK: POST /bookings/{id}/submit
    BK-->>UI: pending
  end

  alt Instructor accepts
    UI->>BK: POST /bookings/{id}/accept
    BK-->>UI: confirmed
  else Instructor rejects
    UI->>BK: POST /bookings/{id}/reject
    BK-->>UI: declined
  end
