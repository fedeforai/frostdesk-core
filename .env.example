# ═══════════════════════════════════════════════════════════════════════════════
# FrostDesk — Environment Variables Reference
# ═══════════════════════════════════════════════════════════════════════════════
# Platform key:  [R] = Railway (API)   [VI] = Vercel Instructor   [VA] = Vercel Admin
#                [S] = Supabase        [ALL] = set everywhere
#
# Required = API won't function correctly without it
# Optional = feature works without it (graceful degradation)
# ═══════════════════════════════════════════════════════════════════════════════

# ── Supabase [ALL] ────────────────────────────────────────────────────────────
# Dashboard → Settings → API
SUPABASE_URL=https://YOUR_PROJECT_REF.supabase.co
SUPABASE_ANON_KEY=<anon-public-key-from-dashboard>
SUPABASE_SERVICE_ROLE_KEY=<service-role-secret-from-dashboard-never-commit>

# ── Database [R] ──────────────────────────────────────────────────────────────
# Supabase → Settings → Database → Connection string
# Password in URI must be URL-encoded (e.g. ! → %21)
DATABASE_URL=postgresql://postgres:[YOUR-PASSWORD]@db.YOUR_PROJECT_REF.supabase.co:5432/postgres

# ── Next.js public vars [VI] [VA] ────────────────────────────────────────────
# Set on Vercel for instructor and admin apps
NEXT_PUBLIC_SUPABASE_URL=https://YOUR_PROJECT_REF.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=<anon-public-key-from-dashboard>
NEXT_PUBLIC_API_URL=https://your-api.up.railway.app

# ── OpenAI [R] ────────────────────────────────────────────────────────────────
OPENAI_API_KEY=your_openai_api_key

# ── Meta / WhatsApp [R] ──────────────────────────────────────────────────────
# Meta Developer Console → WhatsApp → API Setup
META_WHATSAPP_TOKEN=<from-meta-developer-console>
META_WHATSAPP_PHONE_NUMBER_ID=<phone-number-id>
# Meta Developer Console → Webhooks → Verify token (your chosen string)
META_VERIFY_TOKEN=<your-verify-token>
# Meta Developer Console → App → Settings → Basic → App Secret
# Required for webhook signature verification (X-Hub-Signature-256)
META_APP_SECRET=<app-secret-from-meta-developer-console>

# ── WhatsApp multi-tenant routing [R] ────────────────────────────────────────
# Fallback instructor_id when phone_number_id is not in instructor_whatsapp_accounts.
# Set to the default instructor's UUID. Unset = legacy (instructor_id 1).
# DEFAULT_INSTRUCTOR_ID=59a7c6d1-cfdc-40d6-b509-56d53c213477

# ── AI Feature Flags [R] ─────────────────────────────────────────────────────
# AI_EMERGENCY_DISABLE=true    # Kill switch: disables ALL AI (env > DB flags)
ENABLE_AI_SUMMARY=1             # Rolling conversation summary (default ON)
ENABLE_AI_USAGE_TELEMETRY=1     # AI usage telemetry persistence (default ON)

# ── Stripe [R] ───────────────────────────────────────────────────────────────
# Stripe Dashboard → Developers → API keys
# STRIPE_SECRET_KEY=sk_test_...
# STRIPE_WEBHOOK_SECRET=whsec_...
# STRIPE_PRICE_ID=price_...        # Subscription price ID for instructor billing

# ── Stripe UI URLs [R] ──────────────────────────────────────────────────────
# INSTRUCTOR_APP_URL=https://www.frostdesk.ai    # For Stripe return/refresh URLs

# ── Pilot gating [R] ─────────────────────────────────────────────────────────
# Comma-separated instructor UUIDs allowed for paid mutations (create/edit/cancel bookings).
# Empty = all mutations gated (402 PILOT_ONLY).
# PILOT_INSTRUCTOR_IDS=uuid1,uuid2

# ── CORS [R] ─────────────────────────────────────────────────────────────────
# INSTRUCTOR_APP_ORIGIN=https://www.frostdesk.ai
# ADMIN_APP_ORIGIN=https://admin.frostdesk.ai
# EXTRA_ALLOWED_ORIGINS=https://staging.frostdesk.ai

# ── Google Calendar OAuth [R] [VI] ──────────────────────────────────────────
# Google Cloud Console → APIs & Services → Credentials → OAuth 2.0 Client IDs
# GOOGLE_CLIENT_ID=your_client_id.apps.googleusercontent.com
# GOOGLE_CLIENT_SECRET=your_client_secret
# GOOGLE_REDIRECT_URI=https://www.frostdesk.ai/api/instructor/calendar/oauth/callback

# ── Report archival & cron [R] [VA] ──────────────────────────────────────────
# Generate with: openssl rand -hex 32
# ADMIN_REPORTS_CRON_SECRET=your_cron_secret_here
# CRON_SECRET=your_vercel_cron_secret_here    # Vercel injects as Authorization: Bearer
# REPORTS_BUCKET_NAME=reports                  # Supabase Storage bucket (default: reports)

# ── Sentry [R] [VI] [VA] ────────────────────────────────────────────────────
# SENTRY_DSN=https://...@sentry.io/...                    # API (Railway)
# NEXT_PUBLIC_SENTRY_DSN=https://...@sentry.io/...         # Next.js apps (Vercel)

# ── Debug (NEVER in production) ──────────────────────────────────────────────
# ALLOW_DEBUG_USER=1                        # Bypasses admin auth (dev only!)
# SKIP_WHATSAPP_SIGNATURE_VERIFY=1          # Skips webhook signature check (dev only!)
